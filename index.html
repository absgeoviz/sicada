<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediksi Cuaca Adaro (SiCaDa)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        #map { height: 500px; width: 100%; z-index: 0; }
        .chart-container { position: relative; height: 50vh; width: 100%; }
        
        /* Style untuk Label Peta */
        .map-label {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #666;
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 10px;
            font-weight: bold;
            color: #333;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            white-space: nowrap; /* Penting agar label tidak pecah baris */
        }
        .leaflet-tooltip-pane .map-label {
            margin-top: -10px; /* Adjust posisi label */
        }

        /* Modal Styles untuk Image Preview */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9); 
            padding-top: 60px;
        }

        .modal-content {
            margin: auto;
            display: block;
            width: 95%;
            max-width: 1200px;
            max-height: 95vh;
            object-fit: contain; /* Memastikan gambar pas di dalam modal */
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* Style untuk container gambar agar terlihat clickable */
        .image-container-clickable {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .image-container-clickable:hover {
            transform: scale(1.01);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">

    <!-- Navbar -->
    <nav class="bg-emerald-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-cloud-showers-heavy text-2xl mr-3"></i>
                    <span class="font-bold text-xl tracking-wide">Prediksi Cuaca Adaro (SiCaDa)</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Tab Navigation -->
    <div class="bg-white shadow">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-around sm:justify-start">
                <button onclick="switchTab('current')" id="tab-current" class="tab-btn flex-1 sm:flex-none py-4 px-6 text-center text-emerald-600 border-b-2 border-emerald-600 font-medium focus:outline-none">
                    Current
                </button>
                <button onclick="switchTab('historical')" id="tab-historical" class="tab-btn flex-1 sm:flex-none py-4 px-6 text-center text-gray-500 hover:text-emerald-600 font-medium focus:outline-none">
                    Historical
                </button>
                <button onclick="switchTab('forecast')" id="tab-forecast" class="tab-btn flex-1 sm:flex-none py-4 px-6 text-center text-gray-500 hover:text-emerald-600 font-medium focus:outline-none">
                    Forecast
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <!-- PAGE: CURRENT -->
        <div id="page-current" class="page-section space-y-6">
            <div class="bg-white rounded-lg shadow-md p-4">
                <h2 class="text-lg font-bold mb-3 text-slate-700"><i class="fa-solid fa-map-location-dot mr-2"></i>Live Radar & Station Map</h2>
                <div id="map" class="rounded border border-slate-200"></div>
                <div class="mt-2 text-xs text-gray-500 flex justify-between">
                    <span id="radar-timestamp">Radar Time: Loading...</span>
                    <span>Auto-update: 10 min</span>
                </div>
            </div>
            
            <div>
                <h2 class="text-lg font-bold mb-3 text-slate-700"><i class="fa-solid fa-droplet mr-2"></i>Current Rainfall Intensity</h2>
                <div id="station-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    <!-- Cards will be injected here by JS -->
                     <div class="col-span-full text-center py-10 text-gray-400">
                        <i class="fa-solid fa-circle-notch fa-spin text-2xl"></i><br>Loading Station Data...
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE: HISTORICAL -->
        <div id="page-historical" class="page-section hidden space-y-6">
            <div class="bg-white rounded-lg shadow-md p-4">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-700"><i class="fa-solid fa-chart-line mr-2"></i>7-Day Summary</h2>
                    <select id="station-select" class="mt-2 sm:mt-0 block w-full sm:w-64 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm rounded-md border">
                        <option value="">Pilih Station...</option>
                        <!-- Options injected by JS based on manual list -->
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="historyChart"></canvas>
                </div>
                <p class="text-xs text-gray-400 mt-2 text-center">Data source: weather.com (PWS Daily Summary)</p>
            </div>
        </div>

        <!-- PAGE: FORECAST -->
        <div id="page-forecast" class="page-section hidden space-y-6">
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <h2 class="text-lg font-bold mb-6 text-slate-700">Weather Forecast Maps</h2>
                
                <div class="flex flex-col space-y-8 max-w-4xl mx-auto">
                    
                    <!-- Image 1 -->
                    <div class="border rounded-lg shadow-sm overflow-hidden image-container-clickable" onclick="openModal('./data/heatmap_CTNT.png', 'Area CTNT')">
                        <div class="bg-slate-50 p-2 border-b text-left font-semibold text-slate-700">Area CTNT</div>
                        <img src="./data/heatmap_CTNT.png" onerror="this.src='https://via.placeholder.com/800x400?text=heatmap_CTNT+Not+Found'" class="w-full h-auto" alt="Heatmap CTNT">
                    </div>

                    <!-- Image 2 -->
                    <div class="border rounded-lg shadow-sm overflow-hidden image-container-clickable" onclick="openModal('./data/heatmap_SOUTH.png', 'Area SOUTH')">
                        <div class="bg-slate-50 p-2 border-b text-left font-semibold text-slate-700">Area SOUTH</div>
                        <img src="./data/heatmap_SOUTH.png" onerror="this.src='https://via.placeholder.com/800x400?text=heatmap_SOUTH+Not+Found'" class="w-full h-auto" alt="Heatmap SOUTH">
                    </div>

                    <!-- Image 3 -->
                    <div class="border rounded-lg shadow-sm overflow-hidden image-container-clickable" onclick="openModal('./data/heatmap_WARA.png', 'Area WARA')">
                        <div class="bg-slate-50 p-2 border-b text-left font-semibold text-slate-700">Area WARA</div>
                        <img src="./data/heatmap_WARA.png" onerror="this.src='https://via.placeholder.com/800x400?text=heatmap_WARA+Not+Found'" class="w-full h-auto" alt="Heatmap WARA">
                    </div>

                </div>
                <p class="mt-6 text-gray-500 text-sm">Forecast data diperbarui secara berkala.</p>
            </div>
        </div>

    </main>

    <!-- Image Modal for Fullscreen Preview -->
    <div id="imageModal" class="modal">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <!-- Konten gambar di sini -->
        <img class="modal-content" id="modalImage">
    </div>

    <!-- SCRIPT FOR MODAL FUNCTIONALITY (Ditempatkan sebelum script.js agar fungsi openModal tersedia) -->
    <script>
        // Zooming/Panning logic (Tambahan, jika diperlukan)
        let isZoomed = false;
        let scale = 1;
        let currentX = 0;
        let currentY = 0;

        function openModal(src, title) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            
            modalImage.src = src;
            modal.style.display = 'block';

            // Reset zoom state
            isZoomed = false;
            scale = 1;
            currentX = 0;
            currentY = 0;
            modalImage.style.transform = `translate(0, 0) scale(1)`;
            modalImage.style.cursor = 'zoom-in';
            
            // Tambahkan event listener untuk zoom (klik)
            modalImage.onclick = toggleZoom;
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.getElementById('modalImage').onclick = null; // Hapus event listener
        }

        function toggleZoom(event) {
            const modalImage = document.getElementById('modalImage');
            
            if (isZoomed) {
                // Zoom out
                isZoomed = false;
                scale = 1;
                currentX = 0;
                currentY = 0;
                modalImage.style.transform = `translate(0, 0) scale(1)`;
                modalImage.style.cursor = 'zoom-in';
                modalImage.removeEventListener('mousedown', startPan);
            } else {
                // Zoom in ke posisi klik
                isZoomed = true;
                scale = 2; // Perbesar 2x
                
                // Hitung posisi klik relatif terhadap gambar
                const rect = modalImage.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const clickY = event.clientY - rect.top;
                
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                // Hitung translasi agar titik klik berada di tengah layar
                currentX = (centerX - clickX) * scale / 2;
                currentY = (centerY - clickY) * scale / 2;
                
                modalImage.style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;
                modalImage.style.cursor = 'grab';
                
                // Tambahkan event listener untuk pan
                modalImage.addEventListener('mousedown', startPan);
            }
        }
        
        // Pan logic
        let isPanning = false;
        let startX, startY;
        let initialX, initialY;

        function startPan(e) {
            e.preventDefault();
            if (!isZoomed) return;
            isPanning = true;
            startX = e.clientX;
            startY = e.clientY;
            initialX = currentX;
            initialY = currentY;
            document.addEventListener('mousemove', panImage);
            document.addEventListener('mouseup', stopPan);
            document.getElementById('modalImage').style.cursor = 'grabbing';
        }

        function panImage(e) {
            if (!isPanning) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            currentX = initialX + dx;
            currentY = initialY + dy;
            
            document.getElementById('modalImage').style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;
        }

        function stopPan() {
            isPanning = false;
            document.removeEventListener('mousemove', panImage);
            document.removeEventListener('mouseup', stopPan);
            document.getElementById('modalImage').style.cursor = 'grab';
        }

        // Close modal saat klik di luar gambar
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
    
    <!-- Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>
